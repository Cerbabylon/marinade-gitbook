---
description: >-
  當你將你的 SOL 質押在 Marinade 上時，它們會被委託給許多驗證者。 這些驗證者是如何選擇的？ 你能成為他們中的一員嗎？
  讓我們詳細回顧一下我們的委託策略。
---

# 委託策略

## 我們的算法如何選擇驗證者？

Marinade 遵循 Solana 基金會的策略，將**質押分散在高性能、低佣金、非集中的驗證者們**，以增加 Solana 的去中心化和審查阻力。

![Solana 基金會質押策略](https://lh5.googleusercontent.com/93GZfqjM\_ciC\_MXOL349QCnCC81S-r4w0yvUt-kcKdyy2zOGpiWdiUPw4xVM5lQZbqGUEbEpTs2WdXr3cXuyuSiDx3OstnpkPDU6m6Nhe9Bk1jxP4HQZm5vNt4hHGOHQtEQcuyxs)

如你所見，這通過將 SOL 委託給[不屬於安全組的節點](https://medium.com/solana-labs/announcing-the-solana-foundation-delegation-strategy-5bcccf9104ab)來進行實踐。 （例如: 我們不是向已經存在的大型驗證者進行質押，而是試圖鼓勵和支持更多驗證者的存在）。&#x20;

排除這些節點後，以下是驗證者分數中考慮的不同參數：&#x20;

* 性能（APY）&#x20;
* 佣金&#x20;
* 拖欠
* 去中心化目標
* 節點的版本

{% hint style="info" %}
[StakeView](https://stakeview.app) 用於檢查 APY，[validators.app](https://www.validators.app) 用於確定你的數據中心。 其餘部分直接從 Solana 本身提取。&#x20;

這使我們能夠懲罰集中在同一數據中心的驗證者的分數，因為我們的目標是盡可能分散網路。 如果你遇到 validators.app 顯示的數據中心問題，請與他們聯繫。
{% endhint %}

我們評估**所有驗證者**。 我們的公式和用來計算的程式碼都是公開的，結果也是在鏈上。 &#x20;

**我們堅持保持完全透明的並對所有驗證者開放。**

{% hint style="info" %}
我們的目標是為用戶找到收益和價值之間的最佳平衡，價值意味著 APY 和 SOL 市值。 例如: 使 Solana 更加去中心化和抗審查將有助於所有 SOL 代幣持有者，並且可以反映在 SOL 價格中。
{% endhint %}

## 委託公式

Marinade 使用**開源程式碼計算基於性能、佣金和去中心化目標**授予驗證者的“**分數**”。

例如: 一個驗證者會因為表現良好、拖欠率低和佣金低而獲得積分，但如果它已經是 Solana 生態系中最頂端的驗證者之一（按權益衡量），則將扣除所有積分。

根據他們獲得的積分，驗證者將自動獲得總質押的一定百分比。 當用戶質押和取消質押時，Marinade 機器人分配質押和取消質押操作以配對質押百分比與分數（例如: 分數的變化會隨著用戶質押和取消質押而慢慢地反應在分數上）

### 開源計算

計算結果和帶有歷史數據的 SQLite 數據庫會在每個 epoch 後發布在：[https://github.com/marinade-finance/staking-status](https://github.com/marinade-finance/staking-status)

你可以通過在已發布的數據庫上執行此 SQL 查詢來預覽質押機器人將執行的操作：

```
select should_have - marinade_staked, A.* 
  from scores2 A
  where epoch = 281
    and should_have > marinade_staked
  order by score desc
```

為了計算驗證者指標，Marinade 使用了 SPL Stake-o-Matic 程式碼的分叉版本（來自 Solana 程式庫），可在此處獲取：[https://github.com/marinade-finance/delegation-strategy](https://github.com/marinade-finance/delegation-strategy)。&#x20;

它與 Stake-o-Matic 非常相似，同時增加了改進並允許編譯分數並直接應用處理計算。

### 計算細節

以下是用於計算分數並對其進行處理以確定質押/取消質押操作的不同步驟：

* 根據最新 5 個 epoch 對所有驗證者進行評分。 該分數基於 Stake-o-matic 的分叉，可在此[Repo](https://github.com/marinade-finance/delegation-strategy)中找到。 它考慮了 epoch 信用、佣金、去中心化（通過分析使用的數據中心）和節點版本
* 根據此分數選擇前 300 名驗證者（並且每個 epoch 都會有所不同）。 所有其他驗證者將獲得 0 分
* 分析所有驗證者（以確定所需的取消質押操作）。對於質押操作，將僅針對前 300 名驗證者分析**正在進行的 epoch** 的性能，然後一些因素會修改分數：
  * **觀察 epoch 內的信用**（相對於區塊鏈上的所有驗證者）：
    * 如果驗證者的信用低於平均水平的 80%，將在觀察到這一點時執行緊急取消質押
    * 如果驗證者的信用低於其他驗證者平均值的 90%，則分數除以 2
  * **觀察 epoch 內的 APY**（相對於區塊鏈上**所有** APY > 4% 的驗證者的平均值）：
    * 如果 APY 低於平均值的 50%，將在觀察到這一點時執行緊急取消質押
    * 如果 APY 低於平均值的 80%，則分數除以 2
  * 然後考慮根據 `Solana驗證者`指令的**拖欠**。
* 這些計算在 epoch 期間會運行兩次（出於備份和準確性目的），一次在 epoch 估計結束前 24 小時運行，一次在 7 小時前運行。 然後將分數上傳到鏈上

### 質押/取消質押操作

最後，負責質押和取消質押操作的機器人對鏈上分數進行最後一組調整，並分析它們以在質押和取消質押操作之間找到良好的平衡，具體取決於可分配的質押或取消質押。例如：即使在質押增量為正的情況下，這意味著 Marinade 必須向新的驗證者添加質押，也可能需要進行一些取消質押的操作。

以下是最終計算的詳細步驟：

* 一些驗證者會因為欺騙系統或在 epoch 結束前的最後可能時間更改費用而被列入[黑名單](https://github.com/marinade-finance/delegation-strategy/blob/main/cli/score-post-process/src/process\_scores.rs#L561)。每個 epoch，此類驗證者的任何委託都將立即取消其質押
* 如果驗證者的得分為 0（例如：不在前 300 名中）並且 Marinade 將其總質押的 0.45% 以上委託給了驗證者，則除非 Marinade 代表其總質押的 20% 以上，否則它將被取消質押
* 如果驗證者擁有超過應從 Marinade 獲得的 250% 的質押，則除非 Marinade 佔其總質押的 20% 以上，否則它將被取消質押
* 已實施最大質押上限，設定為 Marinade 總質押的 1.5%
* 最後，實行了一個上限：**一個 epoch 收到的質押不能超過當前委託給驗證者的總質押的 0.1%**。
  * 有一個例外：如果驗證者質押嚴重不足（可能會收到超過其當前 Marinade 質押的 2 倍），他們的分數上限為當前分數的 80%，他們將不受此上限的影響。

{% hint style="info" %}
**注意**：驗證者分數為 0 **並不意味著**機器人將從驗證者那邊取消所有質押。 這僅意味著它不會在下一個 epoch 中進行質押，不過如果用戶請求大量取消質押訂單，它將取消質押。
{% endhint %}

{% hint style="info" %}
**注意**：無論之前的 epoch 分數如何，拖欠的驗證者都會被取消質押委託。
{% endhint %}

{% hint style="info" %}
**注意**：選擇參數可以在每個 epoch 之後根據性能結果進行調整，目的是增加代幣持有者的價值。 為了做到這一點，**我們在最大化用戶的 APY（直接方法）和增加 Solana 抗審查性（間接方法，增加網路價值，然後是 SOL 價格）之間尋找一個良好的平衡**。 所有更改都是公開的(可以到[變更表](../changelog.md)查看)，每個驗證者都可以預先計算自己的分數。
{% endhint %}

## Marinade 委託給誰？

目前，Marinade 將 SOL 委託給 450 多個驗證者。

你可以在 [我們的網站](https://marinade.finance/app/staking) 或 [Solana Beach](https://solanabeach.io/address/4bZ6o3eUUNXhKuqjdCnCoPAoLgWiuLYixKaxoa8PpiKk/stakes) 上查看我們當前驗證者的完整列表。

## 如何處理質押帳號?&#x20;

如果你已經在質押你的 SOL，你擁有一個與特定驗證者有關聯的質押帳戶。 你可以將此質押帳戶存入 Marinade 並獲得 mSOL 作為交換，但你的驗證者需要：

* 佣金低於30%&#x20;
* 沒有拖欠

如果不是這種情況，你的質押帳戶將不被接受。 在將 SOL 直接存入 Marinade 之前，你必須先取消質押並取回你的 SOL。
